@startuml MonstrePocheDiagrammeClasses

' ============================================
' MODELS - CORE
' ============================================

class Monstre {
    -nomMonstre : String
    -pointsDeVieMax : double
    -pointsDeVie : double
    -attaque : int
    -defense : int
    -vitesse : int
    -rateAttaque : boolean

    +Monstre(String nomMonstre, double pointsDeVie, int attaque, int defense, int vitesse, ArrayList<Attaque> attaques, Type typeMonstre)
    +getNomMonstre() : String
    +getPointsDeVie() : double
    +getPointsDeVieMax() : double
    +getAttaque() : int
    +getDefense() : int
    +getVitesse() : int
    +getAttaques() : ArrayList<Attaque>
    +getTypeMonstre() : Type
    +getStatut() : StatutMonstre
    +isRateAttaque() : boolean
    +setNomMonstre(String nomMonstre) : void
    +setPointsDeVie(double pointsDeVie) : void
    +setPointsDeVieMax(double pointsDeVieMax) : void
    +setAttaque(int attaque) : void
    +setDefense(int defense) : void
    +setVitesse(int vitesse) : void
    +setAttaques(ArrayList<Attaque> attaques) : void
    +setStatut(StatutMonstre statut) : void
    +setTypeMonstre(Type typeMonstre) : void
    +setRateAttaque(boolean rateAttaque) : void
    +ajouterAttaque(Attaque attaque) : void
    +attaquer(Monstre cible, Terrain terrain, Attaque attaqueUtilisee) : void
    +calculeDegat(Monstre monstreAttaquant, Monstre cible) : double
    +copyOf() : Monstre
    +toString() : String
    +equals(Object obj) : boolean
}

class Joueur {
    -nomJoueur : String
    -monstreActuel : Monstre

    +{static} TAILLE_EQUIPE_MAX : int = 3
    +{static} NOMBRE_ATTAQUES_PAR_MONSTRE : int = 4
    +{static} TAILLE_INVENTAIRE_MAX : int = 5

    +Joueur(String nomJoueur)
    +getNomJoueur() : String
    +getMonstres() : ArrayList<Monstre>
    +getMonstreActuel() : Monstre
    +getObjets() : ArrayList<Objet>
    +setMonstreActuel(Monstre monstreActuel) : void
    +setMonstres(List<Monstre> monstres) : void
    +switchMonstreActuelAuto() : void
    +ajouterMonstre(Monstre monstre) : void
    +ajouterObjet(Objet objet) : void
    +retirerObjet(Objet objet) : void
    +sontMonstresMorts() : boolean
    +toString() : String
    +equals(Object obj) : boolean
}

class Attaque {
    -nomAttaque : String
    -nbUtilisations : int
    -puissanceAttaque : int
    -probabiliteEchec : double

    +Attaque(String nomAttaque, int nbUtilisations, int puissanceAttaque, double probabiliteEchec, Type typeAttaque)
    +getNomAttaque() : String
    +getNbUtilisations() : int
    +getPuissanceAttaque() : int
    +getProbabiliteEchec() : double
    +getTypeAttaque() : Type
    +setNomAttaque(String nomAttaque) : void
    +setNbUtilisations(int nbUtilisations) : void
    +setPuissanceAttaque(int puissanceAttaque) : void
    +setProbabiliteEchec(double probabiliteEchec) : void
    +setTypeAttaque(Type typeAttaque) : void
    +calculeDegatsAttaque(Monstre monstreAttaquant, Monstre cible) : double
    +copyOf() : Attaque
    +toString() : String
}

class Terrain {
    -nomTerrain : String

    +Terrain(String nomTerrain, StatutTerrain statut)
    +getNomTerrain() : String
    +setStatutTerrain(StatutTerrain statutTerrain) : void
    +getStatutTerrain() : StatutTerrain
    +estInnonde() : boolean
    +toString() : String
    +equals(Object obj) : boolean
}

' ============================================
' MODELS - BATTLE
' ============================================

abstract class Combat {
    +joueur1 : Joueur
    +joueur2 : Joueur
    +terrain : Terrain

    +Combat(Joueur joueur1, Joueur joueur2)
    #{abstract} lancer() : void
    #{abstract} executerTour() : void
    #{abstract} afficherMessage(String message) : void
    #{abstract} afficherTitre(String titre) : void
    #{abstract} afficherSousTitre(String sousTitre) : void
    #{abstract} afficherErreur(String erreur) : void
    #{abstract} demanderSaisie(String prompt) : String
    #{abstract} gereChoixAction(Joueur joueur) : Object
    +selectionnerMonstre(Joueur joueur) : void
    +selectionnerAttaque(Joueur joueur) : void
    +selectionnerObjet(Joueur joueur) : void
    +choixAttaque(Joueur joueur) : Attaque
    +utiliseObjet(Joueur joueur) : Objet
    +changeMonstre(Joueur joueur) : Monstre
    #verifierRetraitInondation(Monstre ancienMonstre) : void
    +gereOrdreExecutionActions(Object actionJoueur1, Object actionJoueur2) : void
    +finDePartie() : void
    +getAWinner() : Joueur
}

class CombatLocalTerminal extends Combat {
    +CombatLocalTerminal(Joueur joueur1, Joueur joueur2)
}

class CombatBot extends Combat {
    +CombatBot(Joueur joueur1, Bot joueur2)
}

class CombatEnLigne extends Combat {
    +CombatEnLigne(Joueur joueur1, Joueur joueur2)
}

class Bot extends Joueur {
    +Bot(String nomJoueur)
    +choisirActionAutomatiquement(Monstre monstreAdverse) : Attaque
}

class CombatLogger {
    +{static} setGuiCallback(Consumer<String> callback) : void
    +{static} clear() : void
    +{static} clearCurrentTurn() : void
    +{static} info(String message) : void
    +{static} log(String message) : void
    +{static} logDebutCombat(Joueur joueur1, Joueur joueur2) : void
    +{static} logTourJoueur(Joueur joueur) : void
    +{static} getFormattedCurrentTurnLogs() : String
}

' ============================================
' MODELS - TYPES
' ============================================

abstract class Type {
    #labelType : String
    #faibleContre : String
    #fortContre : String

    +getLabelType() : String
    +estFortContre() : String
    +estFaibleContre() : String
}

class Eau extends Type {
    -probabiliteInnondation : double
    -probabiliteFaireChuter : double

    +Eau()
    +Eau(double probabiliteInnondation, double probabiliteFaireChuter)
    +setProbabiliteInnondation(double probabiliteInnondation) : void
    +setProbabiliteFaireChuter(double probabiliteFaireChuter) : void
    +appliqueCapaciteSpeciale(Terrain terrain, Monstre monstreEau) : void
}

class Feu extends Type {
    -chanceBrulure : double

    +Feu()
    +appliqueCapaciteSpeciale(Monstre cible) : void
}

class Foudre extends Type {
    -chanceParalysie : double

    +Foudre()
    +Foudre(double chanceParalysie)
    +setChanceParalysie(double chanceParalysie) : void
    +appliqueCapaciteSpeciale(Monstre cible) : void
}

class Terre extends Type {
    -{static} CHANCE_FUITE : double = 0.05

    +Terre()
    +appliqueCapaciteSpeciale(Monstre cible) : void
}

class Nature extends Type {
    -{static} COEF_VINGTIEME : double = 0.05

    +Nature()
    +appliqueCapaciteSpeciale(Monstre cible, Terrain terrain) : void
}

class Plante extends Nature {
    -{static} CHANCE_SOIN : double = 0.2

    +Plante()
    +appliqueCapaciteSpeciale(Monstre cible, Terrain terrain) : void
}

class Insecte extends Nature {
    -{static} NB_TOUR_MAX_ATTAQUE_EMPOISONNEMENT : int = 3
    -nbTourAttaque : int

    +Insecte()
    +appliqueCapaciteSpeciale(Monstre cible, Terrain terrain) : void
}

class Normal extends Type {
    +Normal()
}

' ============================================
' MODELS - STATUTS MONSTRE
' ============================================

abstract class StatutMonstre {
    #labelStatut : String
    #nbToursEffet : int
    #nbToursAvecEffet : int

    +decrementerNbToursAvecEffet() : void
    +getLabelStatut() : String
}

class Brule extends StatutMonstre {
    +Brule()
    +appliquerEffets(Monstre cible, double degats) : void
}

class Paralyse extends StatutMonstre {
    -{static} CHANCE_RATER_ATTAQUE : double = 0.375
    -{static} NB_TOURS_MAX_PARALYSIE : int = 6

    +Paralyse()
    +rateAttaque(Monstre cible) : void
    +sortParalysie(Monstre cible) : void
    +appliquerEffets(Monstre cible, double degats) : void
}

class Empoisonne extends StatutMonstre {
    +Empoisonne()
    +appliquerEffets(Monstre cible, double degats) : void
}

class "Normal (Statut)" as NormalStatut extends StatutMonstre {
    +Normal()
}

class SousTerre extends StatutMonstre {
    -{static} NB_TOURS_MAX_FUITE : int = 3
    -{static} NB_TOURS_MIN_FUITE : int = 1

    +SousTerre()
    +appliquerEffets(Monstre cible) : void
    +sortirSousTerre(Monstre cible) : void
}

' ============================================
' MODELS - STATUTS TERRAIN
' ============================================

abstract class StatutTerrain {
    #labelStatut : String
    #nbToursEffet : int
    #nbToursAvecEffet : int

    +decrementerNbToursAvecEffet() : void
    +getNbToursEffet() : int
    +getNbToursAvecEffet() : int
    +getLabelStatut() : String
}

class Innonde extends StatutTerrain {
    -probabiliteFaireChuter : double
    -monstreSource : Monstre

    +Innonde(int nbToursEffet, double probabiliteFaireChuter, Monstre monstreSource)
    +setProbabiliteFaireChuter(double probabiliteFaireChuter) : void
    +getMonstreSource() : Monstre
    +estTermine() : boolean
    +appliquerEffetsTerrain(Monstre cible, Terrain terrain, double degats) : void
    +retraitInnondation(Terrain terrain) : void
}

class Asseche extends StatutTerrain {
    +Asseche()
    +appliquerEffets(Terrain terrain) : void
}

' ============================================
' MODELS - ITEMS
' ============================================

abstract class Objet {
    #nomObjet : String

    +getNomObjet() : String
    +{abstract} utiliserObjet(Monstre cible) : void
    +{abstract} copyOf() : Objet
}

abstract class Potion extends Objet {
    +Potion(String nomObjet)
}

class PotionSante extends Potion {
    -pointsDeSoin : int

    +PotionSante(String nomObjet, int pointsDeSoin)
    +utiliserObjet(Monstre cible) : void
    +copyOf() : PotionSante
}

class PotionDegat extends Potion {
    -pointsDeDegat : int

    +PotionDegat(String nomObjet, int pointsDeDegat)
    +utiliserObjet(Monstre cible) : void
    +copyOf() : PotionDegat
}

class PotionVitesse extends Potion {
    -pointsDeVitesse : int

    +PotionVitesse(String nomObjet, int pointsDeVitesse)
    +utiliserObjet(Monstre cible) : void
    +copyOf() : PotionVitesse
}

abstract class Medicament extends Objet {
    +Medicament(String nomObjet)
}

class MedicamentAntiBrulure extends Medicament {
    +MedicamentAntiBrulure(String nomObjet)
    +utiliserObjet(Monstre cible) : void
    +copyOf() : MedicamentAntiBrulure
}

class MedicamentAntiParalysie extends Medicament {
    +MedicamentAntiParalysie(String nomObjet)
    +utiliserObjet(Monstre cible) : void
    +copyOf() : MedicamentAntiParalysie
}

class MedicamentAntiPoison extends Medicament {
    +MedicamentAntiPoison(String nomObjet)
    +utiliserObjet(Monstre cible) : void
    +copyOf() : MedicamentAntiPoison
}

' ============================================
' CONTROLLERS
' ============================================

interface INavigationCallback {
    +showMainMenu() : void
    +showLocalGameSetup() : void
    +showBotGameSetup() : void
    +showOnlineGameSetup() : void
    +showMonsterSelectionPlayer(Joueur joueur, Runnable onComplete) : void
    +showAttackSelectionPlayer(Joueur joueur, Runnable onComplete) : void
    +showObjectSelectionPlayer(Joueur joueur, Runnable onComplete) : void
    +showBattle(Joueur joueur1, Joueur joueur2) : void
    +showBattleBot(Joueur joueur1, Bot bot) : void
    +showWinnerView(Joueur winner) : void
    +showBattleOnline(BattleView battleView) : void
}

class BattleController {
    -view : BattleView
    -INavigationCallback : INavigationCallback
    -combat : Combat
    -player1Action : Object
    -player2Action : Object
    -player1Ready : boolean
    -player2Ready : boolean

    +BattleController(BattleView view, INavigationCallback INavigationCallback)
    -initializeEventHandlers() : void
    -handleBotTurn() : void
    -handleAttackAction() : void
    -handleSwitchAction() : void
    -handleItemAction() : void
    -executeTurnActions() : void
    -formatAction(Object action) : String
    +getCombat() : Combat
}

class MainMenuController {
    +MainMenuController(MainMenuView view, INavigationCallback callback)
}

class LocalGameController {
    +LocalGameController(LocalGameView view, INavigationCallback callback)
}

class BotGameController {
    +BotGameController(BotGameView view, INavigationCallback callback)
}

class OnlineGameController {
    +OnlineGameController(OnlineGameView view, INavigationCallback callback)
}

class MonsterSelectionController {
    +MonsterSelectionController(MonsterSelectionView view, INavigationCallback callback, Joueur joueur, Runnable onComplete)
}

class AttackSelectionController {
    +AttackSelectionController(AttackSelectionView view, INavigationCallback callback, Joueur joueur, Runnable onComplete)
}

class ObjectSelectionController {
    +ObjectSelectionController(ObjectSelectionView view, INavigationCallback callback, Joueur joueur, Runnable onComplete)
}

class WinnerController {
    +WinnerController(WinnerView view, INavigationCallback callback)
}

' ============================================
' VIEWS
' ============================================

class MonstrePocheUI {
    -{static} WINDOW_WIDTH : long = 1280
    -{static} WINDOW_HEIGHT : long = 720
    -stage : Stage
    -scene : Scene

    +{static} main(String[] args) : void
    +start(Stage stage) : void
    +showMainMenu() : void
    +showLocalGameSetup() : void
    +showBotGameSetup() : void
    +showOnlineGameSetup() : void
    +showMonsterSelectionPlayer(Joueur joueur, Runnable onComplete) : void
    +showAttackSelectionPlayer(Joueur joueur, Runnable onComplete) : void
    +showObjectSelectionPlayer(Joueur joueur, Runnable onComplete) : void
    +showBattle(Joueur joueur1, Joueur joueur2) : void
    +showBattleBot(Joueur joueur1, Bot bot) : void
    +showWinnerView(Joueur winner) : void
    +showBattleOnline(BattleView battleView) : void
}

class BattleView {
    +{static} ATTACK_BUTTON_WIDTH : int = 165
    +{static} ATTACK_BUTTON_HEIGHT : int = 48
    +{static} MONSTER_CARD_WIDTH : int = 110
    +{static} HP_BAR_MAX_WIDTH : double = 160.0
    +{static} ATTACK_GRID_COLUMNS : int = 2
    +{static} HP_RATIO_HIGH_THRESHOLD : double = 0.5
    +{static} HP_RATIO_MEDIUM_THRESHOLD : double = 0.2
    +{static} MAX_LOG_BLOCKS : int = 50

    -joueur1 : Joueur
    -joueur2 : Joueur
    -isPlayer1Turn : boolean

    +BattleView(Joueur joueur1, Joueur joueur2)
    +updateBattleLog(String message) : void
    +clearBattleLog() : void
    +updatePokemonDisplay(Joueur joueur) : void
    +displayAttackChoices(List<Attaque> attaques, Consumer<Attaque> onSelect) : void
    +displayMonsterChoices(List<Monstre> monstres, Consumer<Monstre> onSelect) : void
    +displayItemChoices(List<Objet> objets, Consumer<Objet> onSelect) : void
    +hideAllChoices() : void
    +setTurn(boolean player1Turn) : void
    +getBtnAttack() : Button
    +getBtnItem() : Button
    +getBtnSwitch() : Button
    +getBtnFlee() : Button
    +getJoueur1() : Joueur
    +getJoueur2() : Joueur
    +isPlayer1Turn() : boolean
    +setIsPlayer1Turn(boolean isPlayer1Turn) : void
}

class MainMenuView {
}

class LocalGameView {
}

class BotGameView {
}

class OnlineGameView {
}

class WinnerView {
    +WinnerView(Joueur winner)
}

class MonsterSelectionView {
    +MonsterSelectionView(GameResourcesFactory factory, Joueur joueur)
}

class AttackSelectionView {
    +AttackSelectionView(Joueur joueur)
}

class ObjectSelectionView {
    +ObjectSelectionView(Joueur joueur)
}

abstract class AbstractSelectionView {
}

abstract class AbstractGameSetupView {
}

' ============================================
' RELATIONS - CORE
' ============================================

Joueur "1" --> "0..3" Monstre : -monstres
Joueur "1" --> "1" Monstre : -monstreActuel
Joueur "1" --> "0..5" Objet : -objets
Monstre "1" --> "0..4" Attaque : -attaques
Monstre "1" --> "1" Type : -typeMonstre
Monstre "1" --> "1" StatutMonstre : -statut
Attaque "1" --> "1" Type : -typeAttaque
Terrain "1" --> "1" StatutTerrain : -statutTerrain

' ============================================
' RELATIONS - BATTLE
' ============================================

Combat --> "2" Joueur : joueur1, joueur2
Combat --> "1" Terrain : terrain

' ============================================
' RELATIONS - STATUTS
' ============================================

Innonde --> Monstre : -monstreSource


' ============================================
' RELATIONS - MVC
' ============================================

MonstrePocheUI ..|> INavigationCallback
BattleController --> BattleView : -view
BattleController --> INavigationCallback
BattleController --> Combat : -combat

MainMenuController --> MainMenuView
LocalGameController --> LocalGameView
BotGameController --> BotGameView
OnlineGameController --> OnlineGameView
MonsterSelectionController --> MonsterSelectionView
AttackSelectionController --> AttackSelectionView
ObjectSelectionController --> ObjectSelectionView
WinnerController --> WinnerView

BattleView --> "2" Joueur : joueur1, joueur2

MonsterSelectionView --|> AbstractSelectionView
AttackSelectionView --|> AbstractSelectionView
ObjectSelectionView --|> AbstractSelectionView

LocalGameView --|> AbstractGameSetupView
BotGameView --|> AbstractGameSetupView
OnlineGameView --|> AbstractGameSetupView

@enduml
